podTemplate(
    nodeSelector: 'disktype=ssd',
    label: 'mypod1',
    containers: [
        containerTemplate(name: 'maven', image: 'maven:3.5.4-jdk-8-slim', command: 'sleep', ttyEnabled: true, livenessProbe: containerLivenessProbe( execArgs: '/bin/sh -c "touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600"', initialDelaySeconds: 30, timeoutSeconds: 1, failureThreshold: 3, periodSeconds: 10, successThreshold: 1)),
        containerTemplate(name: 'docker', image: 'docker:18.06.1', command: 'sleep', ttyEnabled: true)
    ],
    volumes: [
        hostPathVolume(mountPath: '/var/run/docker.sock', hostPath: '/var/run/docker.sock'),
        hostPathVolume(mountPath: '/home/jenkins/agent', hostPath: '//c/Users/karigar/mounted'),
        hostPathVolume(mountPath: '/root/.m2', hostPath: '//c/Users/karigar/.m2')
    ]
){
    node('mypod1') {
        stage('Check running containers') {
            container('docker') {
                sh 'hostname'
                sh 'hostname -i'
                sh 'docker ps'
            }
        }

        stage('Build') {
            container('maven') {
                sh "mvn clean package"   
            }
        }   
    }
}
